## 웹 서버, 웹 애플리케이션 서버 WAS

- 웹 서버 -> 정적 리소스
- WAS -> 어플리케이션 로직
- 경계는 모호함
- 자바는 서블릿 컨테이너 기능 제공시 WAS
- WAS는 어플리케이션 코드 실행에 더 특화
- 정적 리소스는 웹 서버가 처리하고 어플리케이션 로직은 WAS 에 요청하여 처리



## 서블릿 컨테이너

- 톰캣 처럼 서블릿을 지원하는 WAS 를 서블릿 컨테이너라고 한다 
- 서블릿 컨테이너는 서블릿 객체를 생성, 초기화, 호출 종료하는 생명 주기 관리
- **<u>서블릿 객체는 싱글톤으로 관리</u>** 
  - 요청마다 객체 생성을 하는것은 비효율적
  - 최초 로딩시 서블릿 객체를 미리 만들고 재활용
  - 모든 요청은 동일한 서블릿 객체 인스턴스에 접근
  - **<u>공유 변수 사용 주의</u>**
  - 서블릿 컨테이너 종료시 함께 종료

- JSP 도 서블릿으로 변환되어서 사용
- 동시 요청에 의한 멀티 스레드 처리 지원



## 요청마다 스레드 생성

- 장점
  - 동시 요청 처리
  - 리소스 허용될 때까지 처리 가능
  - 한 쓰레드 지연되어도 나머지 스레드 정상 작동 

- 단점
  - 스레드 생성 비용이 높음 
  - 한 스레드당 1MB... golang goroutine 은 4kb 인데...
  - 스레드 컨텍스트 스위칭 비용 발생
  - 스레드 생성 제한이 없으면 CPU 한계로 서버 다운 



## 쓰레드 풀

#### 요청마다 쓰레드 생성하는 단점을 보완하다

- 필요한 쓰레드를 쓰레드 풀에 보관하고 관리
- 쓰레드 풀에 생성 가능한 쓰레드 최대치 관리 (톰캣은 최대 200개로 기본 설정)

#### 사용

- 쓰레드 필요시 이미 생성된 쓰레드를 쓰레드 풀에서 꺼내 사용
- 사용 종료시 쓰레드 풀에 쓰레드 반납
- 최대 쓰레드가 모두 사용중이어서 쓰레드 풀에 쓰레드가 없으면 요청 거절 혹은 특정 요청 숫자만큼 대기하도록 설정

#### 장점

- 쓰레드가 미리 생성되어 있어서 쓰레드를 생성하고 종료하는 비용CPU) 절약되고 응답 시간 빠름
- 생성 가능한 스레드 최대치가 있어서 너무 많은 요청 유입시에도 안전하게 처리한다 

#### 최대 스레드 수

##### 너무 낮은 경우

- 동시 요청이 많으면 서버 리소스는 남지만 클라이언트는 금방 응답이 지연됨

##### 너무 높은 경우

- 동시 요청이 많으면 CPU, 메모리 리소스 임계점 초과로 서버가 죽음 

해결법 - 클라우드면 서버 증설 후 튜닝, 아니면 튜닝 ~ 튜닝 ~ 

적정 숫자 - 상황에 따라 다르고 성능 테스트가 필요하다 



## WAS 멀티 스레드 지원

- 멀티 스레드 관련 코드 지원
- 싱글 스레드 프로그래밍 하듯이 소스 개발 
- **<u>멀티 스레드 환경이므로 싱글톤 객체(서블릿, 스프링 빈)는 주의해서 사용</u>** 



## SSR, CSR

### SSR - 서버 사이드 렌더링

- 정적 화면
- JSP, 타임리프

### CSR - 클라이언트 사이드 렌더링

- 화면 동적 생성

- 필요한 부분만 변경 Ajax

- react, vue

  
